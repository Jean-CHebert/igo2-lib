<mat-list-item class="mat-typography">

  <div class="igo-col igo-col-90 igo-col-100-m">
    <mat-select class="logical" [disabled]="!currentFilter.active" (selectionChange)="refreshFilters()" [(ngModel)]="currentFilter.parentLogical"
      *ngIf="activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true">
      <mat-option tooltip-position="above" matTooltipShowDelay="500" [matTooltip]="'igo.geo.operators.tooltip.And' | translate" value="And">{{'igo.geo.operators.And' | translate}}</mat-option>
      <mat-option tooltip-position="above" matTooltipShowDelay="500" [matTooltip]="'igo.geo.operators.tooltip.Or' | translate" value="Or">{{'igo.geo.operators.Or' | translate}}</mat-option>
    </mat-select>
  </div>
  <!-- NON SPATIAL -->
  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== 'Intersects' && currentFilter.operator !== 'Contains' && currentFilter.operator !== 'Within')">
    <span *ngIf="(fields$ | async) && (fields$| async).length > 0 && (fields$| async)[0].name !== ''">
      <mat-select [disabled]="!currentFilter.active" *ngIf="['Contains','Intersects','Within'].indexOf(currentFilter.operator) === -1"
        [(ngModel)]="currentFilter.propertyName" tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="'igo.geo.sourceFields.selectField' | translate"
        (selectionChange)="updateField()">
        <mat-option *ngFor="let field of  (fields$| async)" [value]="field.name">{{field.alias}}</mat-option>
      </mat-select>
    </span>
    <span *ngIf=" (fields$| async) &&  (fields$| async).length === 1 &&  (fields$| async)[0].name === ''">
      <mat-form-field>
        <input [disabled]="!currentFilter.active" matInput #fieldPerUser (keyup)="changeProperty(currentFilter,'propertyName',fieldPerUser.value)"
          (blur)="changeProperty(currentFilter,'propertyName',fieldPerUser.value)" [(ngModel)]="currentFilter.propertyName">

        <button mat-button *ngIf="currentFilter.propertyName" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.propertyName=''">
          <mat-icon svgIcon="close"></mat-icon>
        </button>
      </mat-form-field>

    </span>
  </div>

  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== 'Intersects' && currentFilter.operator !== 'Contains' && currentFilter.operator !== 'Within')">
    <mat-select 
    tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="'igo.geo.filter.selectOperator' | translate"
    [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.operator" (selectionChange)="changeOperator(currentFilter)">
      <mat-option *ngFor="let operator of (ogcFilterOperators$ | async) | keyvalue" [value]="operator.key" tooltip-position="above" matTooltipShowDelay="500" [matTooltip]="('igo.geo.operators.tooltip.'+ operator.key) | translate" >{{('igo.geo.operators.'+ operator.key) | translate}}</mat-option>
    </mat-select>
  </div>

  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator !== 'Intersects' && currentFilter.operator !== 'Contains' && currentFilter.operator !== 'Within')">

    <!-- PropertyIsEqualTo -->
    <span *ngIf="currentFilter.operator === 'PropertyIsEqualTo' || currentFilter.operator === 'PropertyIsNotEqualTo'">
      <mat-form-field [floatLabel]="floatLabel">
        <input [placeholder]="'igo.geo.filter.placeholder' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #expressionequalto (keyup)="changeProperty(currentFilter,'expression',expressionequalto.value)"
          (ngModelChange)="changeProperty(currentFilter,'expression',expressionequalto.value)" [ngModel]="currentFilter.expression">
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">
            <span>{{ value }}</span>
          </mat-option>
        </mat-autocomplete>
        <button mat-button *ngIf="currentFilter.expression" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.expression=''">
          <mat-icon svgIcon="close"></mat-icon>
        </button>
      </mat-form-field>

    </span>
    <!-- PropertyIsEqualTo  -->


    <!-- PropertyIsLike  -->
    <span *ngIf="currentFilter.operator === 'PropertyIsLike'">
      <mat-form-field [floatLabel]="floatLabel">
        <input [placeholder]="'igo.geo.filter.placeholder' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #pattern (keyup)="changeProperty(currentFilter,'pattern',pattern.value)"
          (ngModelChange)="changeProperty(currentFilter,'pattern',pattern.value)" [ngModel]="currentFilter.pattern">
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">
            <span>{{ value }}</span>
          </mat-option>
        </mat-autocomplete>
        <button mat-button *ngIf="currentFilter.pattern" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.pattern=''">
          <mat-icon svgIcon="close"></mat-icon>
        </button>
      </mat-form-field>

    </span>
    <!-- PropertyIsLike  -->

    <!-- PropertyIsNull  -->
    <span *ngIf="currentFilter.operator === 'PropertyIsNull'"></span>
    <!-- PropertyIsNull  -->

    <!-- PropertyIs_Than  -->
    <span *ngIf="currentFilter.operator === 'PropertyIsGreaterThan' || currentFilter.operator === 'PropertyIsGreaterThanOrEqualTo' || currentFilter.operator === 'PropertyIsLessThan' || currentFilter.operator === 'PropertyIsLessThanOrEqualTo'">
      <mat-form-field [floatLabel]="floatLabel">
        <input [placeholder]="'igo.geo.filter.placeholder' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #expressionthan type="number" (keyup)="changeNumericProperty(currentFilter,'expression',expressionthan.value)"
          (ngModelChange)="changeNumericProperty(currentFilter,'expression',expressionthan.value)" [ngModel]="currentFilter.expression">
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">
            <span>{{ value }}</span>
          </mat-option>
        </mat-autocomplete>
        <button mat-button *ngIf="currentFilter.expression" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.expression=''">
          <mat-icon svgIcon="close"></mat-icon>
        </button>
      </mat-form-field>
    </span>
    <!-- PropertyIs_Than  -->


    <!-- PropertyIsBetween -->
    <span *ngIf="currentFilter.operator === 'PropertyIsBetween'">
      <mat-form-field [floatLabel]="floatLabel">
        <input [placeholder]="'igo.geo.filter.placeholder' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #lowerBoundary type="number" (keyup)="changeNumericProperty(currentFilter,'lowerBoundary',lowerBoundary.value)"
          (ngModelChange)="changeNumericProperty(currentFilter,'lowerBoundary',lowerBoundary.value)" [ngModel]="currentFilter.lowerBoundary">
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">
            <span>{{ value }}</span>
          </mat-option>
        </mat-autocomplete>
        <button mat-button *ngIf="currentFilter.lowerBoundary" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.lowerBoundary=''">
          <mat-icon svgIcon="close"></mat-icon>
        </button>
      </mat-form-field>
      <mat-form-field [floatLabel]="floatLabel">
        <input [placeholder]="'igo.geo.filter.placeholder' | translate" [disabled]="!currentFilter.active" matInput [matAutocomplete]="auto" #upperBoundary type="number" (keyup)="changeNumericProperty(currentFilter,'upperBoundary',upperBoundary.value)"
          (ngModelChange)="changeNumericProperty(currentFilter,'upperBoundary',upperBoundary.value)" [ngModel]="currentFilter.upperBoundary">
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option *ngFor="let value of values" [value]="value" matTooltipShowDelay="500" [matTooltip]="value">
            <span>{{ value }}</span>
          </mat-option>
        </mat-autocomplete>
        <button mat-button *ngIf="currentFilter.upperBoundary" matSuffix mat-icon-button aria-label="Clear" (click)="currentFilter.upperBoundary=''">
          <mat-icon svgIcon="close"></mat-icon>
        </button>
      </mat-form-field>

    </span>
    <!-- PropertyIsBetween  -->


    <!-- During -->
    <span *ngIf="currentFilter.operator === 'During'">
      <span *ngIf="calendarType() === 'datetime'">
        <div class="igo-col igo-col-100">
          <mat-form-field>
            <mat-datetimepicker-toggle matSuffix [for]="startDatetimepicker" openOnFocus="true"></mat-datetimepicker-toggle>
            <mat-datetimepicker #startDatetimepicker [startView]="calendarView()" [type]="calendarType()"
                                openOnFocus="true" [startAt]="handleDate(currentFilter.begin)"
                                (yearSelected)="yearSelected($event, startDatetimepicker, 'begin')" 
                                (monthSelected)="monthSelected($event, startDatetimepicker, 'begin')">
            </mat-datetimepicker>
            <input [matDatetimepicker]="startDatetimepicker" [placeholder]="'igo.geo.timeFilter.startDate' | translate" 
              [disabled]="!currentFilter.active" matInput #begin 
              (dateChange)="changeTemporalProperty(currentFilter,'begin',begin.value)" 
              [matDatepickerFilter]="dateFilter.bind(this, 'begin')"
              [value]="currentFilter.begin?handleDate(currentFilter.begin):handleDate(datasource.options.minDate)"
              [min]="handleDate(datasource.options.minDate)"
              [max]="handleDate(currentFilter.end)" >
          </mat-form-field>
        </div>

        <div class="igo-col igo-col-100">
          <mat-form-field>
            <mat-datetimepicker-toggle matSuffix [for]="endDatetimepicker" openOnFocus="true"></mat-datetimepicker-toggle>
            <mat-datetimepicker #endDatetimepicker [startView]="calendarView()" [type]="calendarType()"
                                openOnFocus="true" [startAt]="handleDate(currentFilter.end)"
                                (yearSelected)="yearSelected($event, endDatetimepicker, 'end')" 
                                (monthSelected)="monthSelected($event, endDatetimepicker, 'end')">
            </mat-datetimepicker>
            <input [matDatetimepicker]="endDatetimepicker" [placeholder]="'igo.geo.timeFilter.endDate' | translate" 
              [disabled]="!currentFilter.active" matInput #end 
              (dateChange)="changeTemporalProperty(currentFilter,'end',end.value)" 
              [matDatepickerFilter]="dateFilter.bind(this, 'end')"
              [value]="currentFilter.end?handleDate(currentFilter.end):handleDate(datasource.options.maxDate)"
              [min]="handleDate(currentFilter.begin)"
              [max]="handleDate(datasource.options.maxDate)" >
          </mat-form-field>
        </div>

      </span>

      <span *ngIf="calendarType() !== 'datetime'">
        <div class="igo-col igo-col-100">
          <mat-form-field>
            <mat-datepicker-toggle matSuffix [for]="startDatepicker" openOnFocus="true"></mat-datepicker-toggle>
            <mat-datepicker #startDatepicker [startView]="calendarView()" 
                                openOnFocus="true"  [startAt]="handleDate(currentFilter.begin)"
                                (yearSelected)="yearSelected($event, startDatepicker, 'begin')" 
                                (monthSelected)="monthSelected($event, startDatepicker, 'begin')">
            </mat-datepicker>
            <input [matDatepicker]="startDatepicker" [placeholder]="'igo.geo.timeFilter.startDate' | translate" 
              [disabled]="!currentFilter.active" matInput #begin
              (dateChange)="changeTemporalProperty(currentFilter,'begin',begin.value)" 
              [matDatepickerFilter]="dateFilter.bind(this, 'begin')"
              [value]="currentFilter.begin?handleDate(currentFilter.begin):handleDate(datasource.options.minDate)"
              [min]="handleDate(datasource.options.minDate)"
              [max]="handleDate(currentFilter.end)" >
          </mat-form-field>
        </div>

        <div class="igo-col igo-col-100">
          <mat-form-field>
            <mat-datepicker-toggle matSuffix [for]="endDatepicker" openOnFocus="true"></mat-datepicker-toggle>
            <mat-datepicker #endDatepicker [startView]="calendarView()" 
                                openOnFocus="true" [startAt]="handleDate(currentFilter.end)"
                                (yearSelected)="yearSelected($event, endDatepicker, 'end')" 
                                (monthSelected)="monthSelected($event, endDatepicker, 'end')">
            </mat-datepicker>
            <input [matDatepicker]="endDatepicker" [placeholder]="'igo.geo.timeFilter.endDate' | translate" 
              [disabled]="!currentFilter.active" matInput #end 
              (dateChange)="changeTemporalProperty(currentFilter,'end',end.value)" 
              [matDatepickerFilter]="dateFilter.bind(this, 'end')"
              [value]="currentFilter.end?handleDate(currentFilter.end):handleDate(datasource.options.maxDate)"
              [min]="handleDate(currentFilter.begin)"
              [max]="handleDate(datasource.options.maxDate)" >
          </mat-form-field>
        </div>
      </span>
    </span>
    <!-- During  -->
  </div>
  <!-- NON SPATIAL -->


  <!-- PropertySpatial  -->
  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === 'Intersects' || currentFilter.operator === 'Contains' || currentFilter.operator === 'Within')">
    <mat-select  
      matTooltipShowDelay="500" [matTooltip]="'igo.geo.filter.selectOperator' | translate" tooltip-position="below"
      [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.operator" (selectionChange)="changeOperator(currentFilter)">
      <mat-option *ngFor="let operator of (ogcFilterOperators$ | async) | keyvalue" [value]="operator.key"  tooltip-position="above" matTooltipShowDelay="500" [matTooltip]="('igo.geo.operators.tooltip.'+ operator.key) | translate" >{{('igo.geo.operators.'+ operator.key) | translate}}</mat-option>
    </mat-select>
  </div>
  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === 'Intersects' || currentFilter.operator === 'Contains' || currentFilter.operator === 'Within')">
    <mat-select [disabled]="!currentFilter.active" [(ngModel)]="currentFilter.igoSpatialSelector" (selectionChange)="changeGeometry(currentFilter,value)">
      <mat-option *ngFor="let igoSpatialSelector of igoSpatialSelectors" [value]="igoSpatialSelector.type">{{('igo.geo.spatialSelector.'+ igoSpatialSelector.type) | translate}}</mat-option>
    </mat-select>
  </div>

  <div class="igo-col igo-col-90 igo-col-100-m" *ngIf="(currentFilter.operator === 'Intersects' || currentFilter.operator === 'Contains' || currentFilter.operator === 'Within')">
    <button mat-button [disabled]="!currentFilter.active" *ngIf="currentFilter.igoSpatialSelector === 'fixedExtent'"
      matSuffix mat-icon-button aria-label="Clear" (click)="changeGeometry(currentFilter,value)" tooltip-position="below" matTooltipShowDelay="500"
      [matTooltip]="'igo.geo.spatialSelector.btnSetExtent' | translate">
      <mat-icon svgIcon="arrow-expand-all"></mat-icon>
    </button>


    <mat-form-field *ngIf="currentFilter.igoSpatialSelector === 'snrc'" [floatLabel]="floatLabel">
      <input [placeholder]="'igo.geo.filter.placeholderSnrc' | translate" matInput #htmlSnrc (keyup)="changeGeometry(currentFilter,htmlSnrc.value)" (blur)="changeGeometry(currentFilter,htmlSnrc.value)"
        [(ngModel)]="snrc">
      <button mat-button *ngIf="snrc" matSuffix mat-icon-button aria-label="Clear" (click)="snrc=''">
        <mat-icon svgIcon="close"></mat-icon>
      </button>
    </mat-form-field>
  </div>
  <!-- PropertySpatial  -->

  <!-- <mat-checkbox labelPosition='before' (change)="changeCaseSensitive($event)" [(ngModel)]="currentFilter.matchCase">
    {{('igo.geo.operators.caseSensitive') | translate}}
  </mat-checkbox> -->

  <div class="igo-col igo-col-100 igo-col-100-m">
    <div class="igo-layer-button-group">
      <mat-slide-toggle class="example-margin" (change)="toggleFilterState($event,currentFilter,'active')" tooltip-position="below"
        matTooltipShowDelay="500" [matTooltip]="'igo.geo.filter.toggleFilterState' | translate" [color]="color" [checked]="currentFilter.active"
        [disabled]="disabled">
      </mat-slide-toggle>
      <button mat-icon-button tooltip-position="below" matTooltipShowDelay="500" [matTooltip]="'igo.geo.filter.removeFilter' | translate"
        color="warn" (click)="deleteFilter(currentFilter)">
        <mat-icon svgIcon="delete"></mat-icon>
      </button>
    </div>
  </div>
  <mat-divider></mat-divider>
</mat-list-item>
