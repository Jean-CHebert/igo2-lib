<igo-list [selection]="false" [ngClass]="contextTool ? 'igo-list-min-height': 'igo-list-max-height'">
  <mat-form-field *ngIf="showFilter()" class="contextFilter">
    <input
      matInput
      type="text"
      [placeholder]="'igo.context.contextManager.filterPlaceHolder' | translate"
      [(ngModel)]="term">
    <button
      mat-button
      mat-icon-button
      matSuffix
      class="clear-button"
      *ngIf="term.length"
      aria-label="Clear"
      color="warn"
      (click)="term = ''">
      <mat-icon svgIcon="close"></mat-icon>
    </button>
  </mat-form-field>

  <ng-template ngFor let-groupContexts [ngForOf]="contexts$ | async | keyvalue">

    <igo-collapsible *ngIf="groupContexts.value.length && auth.authenticated" [title]="titleMapping[groupContexts.key] | translate">

      <ng-template ngFor let-context [ngForOf]="groupContexts.value">
        <igo-context-item
          igoListItem
          color="accent"
          [selected]="selectedContext && selectedContext.uri === context.uri"
          [selectedContext]="selectedContext"
          [context]="context"
          [default]="context.id && this.defaultContextId && this.defaultContextId === context.id"
          [activeContext]="activeContext"
          (save)="save.emit(context)"
          (favorite)="favorite.emit(context)"
          (manageTools)="manageTools.emit(context)"
          (select)="select.emit(context)"
          (unselect)="unselect.emit(context)"
          (action)="toggleContextTool($event)">
        </igo-context-item>
      </ng-template>

    </igo-collapsible>

    <ng-template *ngIf="groupContexts.value.length && !auth.authenticated" ngFor let-context [ngForOf]="groupContexts.value">
      <igo-context-item
        igoListItem
        color="accent"
        [selected]="selectedContext && selectedContext.uri === context.uri"
        [context]="context"
        [default]="this.defaultContextId === context.id"
        (select)="select.emit(context)"
        (unselect)="unselect.emit(context)">
      </igo-context-item>
    </ng-template>

  </ng-template>
</igo-list>

<igo-panel *ngIf="auth.authenticated && activeContext && contextTool" [title]="activeContext.title">
  <div #actions class="igo-actions-container">

    <button
      mat-icon-button
      [matTooltip]="'igo.context.contextManager.save' | translate"
      matTooltipShowDelay="500"
      color="primary"
      (click)="save.emit(activeContext)">
      <mat-icon svgIcon="content-save"></mat-icon>
    </button>

    <button
      mat-icon-button
      [matTooltip]="'igo.context.contextManager.managePermissions' | translate"
      matTooltipShowDelay="500"
      color="primary"
      (click)="managePermissions.emit(activeContext)">
      <mat-icon svgIcon="account-outline"></mat-icon>
    </button>

    <!--button
      mat-icon-button
      [matTooltip]="'igo.context.contextManager.manageTools' | translate"
      [color]="color"
      (click)="manageTools.emit(context)">
      <mat-icon svgIcon="widgets"></mat-icon>
    </button-->

    <button
      mat-icon-button
      [matTooltip]="'igo.context.contextManager.clone' | translate"
      matTooltipShowDelay="500"
      color="primary"
      (click)="clone.emit(activeContext)">
      <mat-icon svgIcon="content-copy"></mat-icon>
    </button>

    <button
      mat-icon-button
      color="primary"
      [matTooltip]="'igo.context.contextManager.edit' | translate"
      matTooltipShowDelay="500"
      (click)="edit.emit(activeContext)">
      <mat-icon svgIcon="pencil"></mat-icon>
    </button>

    <button
      mat-icon-button
      color="warn"
      [matTooltip]="'igo.context.contextManager.delete' | translate"
      matTooltipShowDelay="500"
      (click)="delete.emit(activeContext)">
      <mat-icon svgIcon="delete"></mat-icon>
    </button>
  </div>
</igo-panel>